{"version":3,"file":"feature-select-4964532a.js","sources":["../src/gis/core/modules/feature-select.js"],"sourcesContent":["import BoxSelection from '../../../gis/core/interactions/box-selection';\nimport classMixin from '../../utils/class-mixin';\nimport GISEvent from '../common/gis-event';\nimport ToggleActive from '../common/toggle-active';\nimport { unByKey } from 'ol/Observable';\n\nexport default class FeatureSelect extends classMixin(GISEvent, ToggleActive) {\n  _map;\n  _boxSelection;\n  _features = [];\n  _listener = {\n    select: null\n  };\n\n  constructor(map) {\n    super('start,select,end');\n\n    this._map = map;\n    this._boxSelection = new BoxSelection(map);\n\n    this.toggleFeatureSelectListener();\n    this._onBoxEnd = this._onBoxEnd.bind(this);\n  }\n\n  // 激活 extends ToggleActive\n  activateHandle() {\n    // bosSelect start/end 事件\n    this._boxSelection.on('boxend', this._onBoxEnd);\n\n    // 激活框选\n    this._boxSelection.activate();\n  }\n\n  // 关闭 extends ToggleActive\n  deactivateHandle() {\n    this._boxSelection.offAll();\n\n    // 关闭框选\n    this._boxSelection.deactivate();\n  }\n\n  // listener select event\n  toggleFeatureSelectListener(state = !this._listener.select) {\n    const listenerKey = this._listener.select;\n    if (state) {\n      if (listenerKey) {\n        this.toggleFeatureSelectListener();\n      }\n      this._listener.select = this._map.selectInteraction.on('select', (e) => {\n        const selectedFeature = e.selected;\n        if (selectedFeature.length) {\n          this.dispatch('select', selectedFeature[0].get('BSM'));\n        }\n      });\n    } else {\n      unByKey(listenerKey);\n      this._listener.select = null;\n    }\n  }\n\n  /**\n   * 更新要素列表\n   * @param {Array} features\n   */\n  updateFeatures(features) {\n    this._features = features;\n  }\n\n  /**\n   * 点选要素\n   * @param {String} BSM\n   * @return {Object} 返回该 feature 对象\n   */\n  selectFeature(BSM) {\n    const map = this._map;\n    const feature = this._features.find((item) => BSM === item.get('BSM'));\n\n    feature && setTimeout(() => map.selectFeature(feature), 300);\n  }\n\n  /**\n   * 框选结束时\n   * @param {Array} extent 框选范围\n   * @private\n   */\n  _onBoxEnd(extent) {\n    this.dispatch('start', extent);\n    this._map.searchFeature({ extent }).then(\n      (res) => {\n        this.updateFeatures(res.features);\n        this.dispatch('end', {\n          state: true,\n          data: res.data\n        });\n      },\n      (error) => {\n        this.dispatch('end', {\n          state: false,\n          message: error\n        });\n      }\n    );\n  }\n}\n"],"names":["FeatureSelect","map","select","_map","_boxSelection","BoxSelection","toggleFeatureSelectListener","_onBoxEnd","bind","on","activate","offAll","deactivate","state","_listener","listenerKey","selectInteraction","e","selectedFeature","selected","length","dispatch","get","unByKey","features","_features","BSM","feature","find","item","setTimeout","selectFeature","extent","searchFeature","then","res","updateFeatures","data","error","message","classMixin","GISEvent","ToggleActive"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAMqBA;;;;;yBAQPC,GAAZ,EAAiB;;;;;uFACT,kBAAN;;;;;;gEANU,EAKK;;gEAJL;MACVC,MAAM,EAAE;KAGO;;UAGVC,IAAL,GAAYF,GAAZ;UACKG,aAAL,GAAqB,IAAIC,YAAJ,CAAiBJ,GAAjB,CAArB;;UAEKK,2BAAL;;UACKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,+BAAjB;;;;;;qCAIe;WAEVJ,aAAL,CAAmBK,EAAnB,CAAsB,QAAtB,EAAgC,KAAKF,SAArC;;WAGKH,aAAL,CAAmBM,QAAnB;;;;uCAIiB;WACZN,aAAL,CAAmBO,MAAnB;;WAGKP,aAAL,CAAmBQ,UAAnB;;;;kDAI0D;;;UAAhCC,KAAgC,uEAAxB,CAAC,KAAKC,SAAL,CAAeZ,MAAQ;UACpDa,WAAW,GAAG,KAAKD,SAAL,CAAeZ,MAAnC;;UACIW,KAAJ,EAAW;YACLE,WAAJ,EAAiB;eACVT,2BAAL;;;aAEGQ,SAAL,CAAeZ,MAAf,GAAwB,KAAKC,IAAL,CAAUa,iBAAV,CAA4BP,EAA5B,CAA+B,QAA/B,EAAyC,UAACQ,CAAD,EAAO;cAChEC,eAAe,GAAGD,CAAC,CAACE,QAA1B;;cACID,eAAe,CAACE,MAApB,EAA4B;YAC1B,MAAI,CAACC,QAAL,CAAc,QAAd,EAAwBH,eAAe,CAAC,CAAD,CAAf,CAAmBI,GAAnB,CAAuB,KAAvB,CAAxB;;SAHoB,CAAxB;OAJF,MAUO;QACLC,OAAO,CAACR,WAAD,CAAP;aACKD,SAAL,CAAeZ,MAAf,GAAwB,IAAxB;;;;;mCAQWsB,UAAU;WAClBC,SAAL,GAAiBD,QAAjB;;;;kCAQYE,KAAK;UACXzB,GAAG,GAAG,KAAKE,IAAjB;;UACMwB,OAAO,GAAG,KAAKF,SAAL,CAAeG,IAAf,CAAoB,UAACC,IAAD;eAAUH,GAAG,KAAKG,IAAI,CAACP,GAAL,CAAS,KAAT,CAAlB;OAApB,CAAhB;;MAEAK,OAAO,IAAIG,UAAU,CAAC;eAAM7B,GAAG,CAAC8B,aAAJ,CAAkBJ,OAAlB,CAAN;OAAD,EAAmC,GAAnC,CAArB;;;;8BAQQK,QAAQ;;;WACXX,QAAL,CAAc,OAAd,EAAuBW,MAAvB;;WACK7B,IAAL,CAAU8B,aAAV,CAAwB;QAAED,MAAM,EAANA;OAA1B,EAAoCE,IAApC,CACE,UAACC,GAAD,EAAS;QACP,MAAI,CAACC,cAAL,CAAoBD,GAAG,CAACX,QAAxB;;QACA,MAAI,CAACH,QAAL,CAAc,KAAd,EAAqB;UACnBR,KAAK,EAAE,IADY;UAEnBwB,IAAI,EAAEF,GAAG,CAACE;SAFZ;OAHJ,EAQE,UAACC,KAAD,EAAW;QACT,MAAI,CAACjB,QAAL,CAAc,KAAd,EAAqB;UACnBR,KAAK,EAAE,KADY;UAEnB0B,OAAO,EAAED;SAFX;OATJ;;;;;EAjFuCE,UAAU,CAACC,QAAD,EAAWC,YAAX;;;;"}