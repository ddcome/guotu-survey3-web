{"version":3,"file":"history-record-cc57ce41.js","sources":["../src/gis/core/modules/history-record.js"],"sourcesContent":["import isEqual from 'lodash/isEqual';\n\n/**\n * 地图历史记录管理类\n */\nexport default class HistoryRecord {\n  _mapView;\n  _data = []; // 历史记录数据\n  _index = -1; // 历史记录当前 index\n  _isAuto = false; // 是否是自动跳转\n  _zoomInteractions;\n\n  /**\n   * 实例化历史记录管理\n   * @param {Map} map  Map 实例对象\n   */\n  constructor(map) {\n    this._zoomInteractions = map.interactions.zoom;\n    this._mapView = map.olView;\n\n    // 添加首次记录\n    this._add();\n\n    // 绑定事件\n    map.olMap.on('moveend', () => {\n      this._add();\n    });\n  }\n\n  /**\n   * 历史记录操作\n   * @param {Number} direction 1 next -1 prev\n   */\n  change(direction) {\n    direction === 1 ? this._next() : this._prev();\n  }\n\n  /**\n   * 清空历史记录\n   */\n  clean() {\n    this._data = [this._data[this._maxIndex]];\n    this._changeIndex(0);\n  }\n\n  /**\n   * 获取最大的 index\n   * @private\n   */\n  get _maxIndex() {\n    return this._data.length - 1;\n  }\n\n  /**\n   * 下一个历史记录\n   * @private\n   */\n  _next() {\n    const index = Math.min(this._maxIndex, this._index + 1);\n    this._changeIndex(index);\n  }\n\n  /**\n   * 上一个历史记录\n   * @private\n   */\n  _prev() {\n    const index = Math.max(0, this._index - 1);\n    this._changeIndex(index);\n  }\n\n  /**\n   * 修改当前下标\n   * @param {Number} index 设置的下标\n   * @private\n   */\n  _changeIndex(index) {\n    this._index = index;\n    const history = this._data[index];\n    this._zoomInteractions.animate({ ...history });\n    this._isAuto = true;\n  }\n\n  /**\n   * 添加一条新纪录\n   * @private\n   */\n  _add() {\n    // 过滤自动跳转\n    if (this._isAuto) {\n      this._isAuto = false;\n      return;\n    }\n\n    const view = this._mapView;\n    const history = {\n      center: view.getCenter(),\n      zoom: view.getZoom()\n    };\n    const lastHistory = this._data[this._maxIndex];\n\n    // 过滤重复的\n    if (!isEqual(history, lastHistory)) {\n      const deleteCount = this._maxIndex - this._index;\n      this._index++;\n      if (deleteCount > 0) {\n        this._data.splice(this._index, deleteCount, history);\n      } else {\n        this._data.push(history);\n      }\n    }\n  }\n}\n"],"names":["HistoryRecord","map","_zoomInteractions","interactions","zoom","_mapView","olView","_add","olMap","on","direction","_next","_prev","_data","_maxIndex","_changeIndex","index","Math","min","_index","max","history","animate","_isAuto","view","center","getCenter","getZoom","lastHistory","isEqual","deleteCount","splice","push","length"],"mappings":";;;;;;;;;;;;IAKqBA;;;yBAWPC,GAAZ,EAAiB;;;;;;;mCATT,EASS;;oCARR,CAAC,CAQO;;qCAPP,KAOO;;;;SACVC,iBAAL,GAAyBD,GAAG,CAACE,YAAJ,CAAiBC,IAA1C;SACKC,QAAL,GAAgBJ,GAAG,CAACK,MAApB;;SAGKC,IAAL;;IAGAN,GAAG,CAACO,KAAJ,CAAUC,EAAV,CAAa,SAAb,EAAwB,YAAM;MAC5B,KAAI,CAACF,IAAL;KADF;;;;;2BASKG,WAAW;MAChBA,SAAS,KAAK,CAAd,GAAkB,KAAKC,KAAL,EAAlB,GAAiC,KAAKC,KAAL,EAAjC;;;;4BAMM;WACDC,KAAL,GAAa,CAAC,KAAKA,KAAL,CAAW,KAAKC,SAAhB,CAAD,CAAb;;WACKC,YAAL,CAAkB,CAAlB;;;;4BAeM;UACAC,KAAK,GAAGC,IAAI,CAACC,GAAL,CAAS,KAAKJ,SAAd,EAAyB,KAAKK,MAAL,GAAc,CAAvC,CAAd;;WACKJ,YAAL,CAAkBC,KAAlB;;;;4BAOM;UACAA,KAAK,GAAGC,IAAI,CAACG,GAAL,CAAS,CAAT,EAAY,KAAKD,MAAL,GAAc,CAA1B,CAAd;;WACKJ,YAAL,CAAkBC,KAAlB;;;;iCAQWA,OAAO;WACbG,MAAL,GAAcH,KAAd;UACMK,OAAO,GAAG,KAAKR,KAAL,CAAWG,KAAX,CAAhB;;WACKd,iBAAL,CAAuBoB,OAAvB,mBAAoCD,OAApC;;WACKE,OAAL,GAAe,IAAf;;;;2BAOK;UAED,KAAKA,OAAT,EAAkB;aACXA,OAAL,GAAe,KAAf;;;;UAIIC,IAAI,GAAG,KAAKnB,QAAlB;UACMgB,OAAO,GAAG;QACdI,MAAM,EAAED,IAAI,CAACE,SAAL,EADM;QAEdtB,IAAI,EAAEoB,IAAI,CAACG,OAAL;OAFR;UAIMC,WAAW,GAAG,KAAKf,KAAL,CAAW,KAAKC,SAAhB,CAApB;;UAGI,CAACe,OAAO,CAACR,OAAD,EAAUO,WAAV,CAAZ,EAAoC;YAC5BE,WAAW,GAAG,KAAKhB,SAAL,GAAiB,KAAKK,MAA1C;aACKA,MAAL;;YACIW,WAAW,GAAG,CAAlB,EAAqB;eACdjB,KAAL,CAAWkB,MAAX,CAAkB,KAAKZ,MAAvB,EAA+BW,WAA/B,EAA4CT,OAA5C;SADF,MAEO;eACAR,KAAL,CAAWmB,IAAX,CAAgBX,OAAhB;;;;;;wBA3DU;aACP,KAAKR,KAAL,CAAWoB,MAAX,GAAoB,CAA3B;;;;;;;;;"}