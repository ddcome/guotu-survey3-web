{"version":3,"file":"chunk-03adc81b.js","sources":["../src/gis/core/interactions/box-selection.js"],"sourcesContent":["import DragBox from 'ol/interaction/DragBox';\nimport OlFeature from 'ol/Feature';\n\nimport GISEvent from '../common/gis-event';\nimport classMixin from '../../utils/class-mixin';\nimport ToggleActive from '../common/toggle-active';\n\n/**\n * 框选操作基类\n */\nexport default class BoxSelection extends classMixin(GISEvent, ToggleActive) {\n  _map;\n  _olMap;\n  _vectorSource;\n  _dragBox;\n  _feature;\n\n  constructor(map) {\n    super('boxstart,boxend');\n\n    this._map = map;\n    this._olMap = map.olMap;\n    this._vectorSource = map.vectorSource;\n\n    map.eventHub.on('clear', () => this.removeBoxFeature());\n  }\n\n  // 激活 extends ToggleActive\n  activateHandle() {\n    const map = this._map;\n\n    // 切换光标样式\n    map.toggleCursorStyle('crosshair');\n\n    // 添加图层与交互\n    this._dragBox = new DragBox({\n      minArea: 0\n    });\n    this._olMap.addInteraction(this._dragBox);\n\n    // 绑定事件\n    this._dragBox.on('boxstart', () => {\n      map.toggleSelectInteraction(false);\n\n      this.dispatch('boxstart');\n    });\n    this._dragBox.on('boxend', () => {\n      map.toggleSelectInteraction(true);\n\n      // 获取框选范围\n      const geometry = this._dragBox.getGeometry();\n      const extent = geometry.getExtent();\n\n      // 清理旧的框选\n      this.removeBoxFeature();\n\n      // 添加新的框选要素\n      this.addBoxFeature(\n        new OlFeature({\n          geometry\n        })\n      );\n\n      // 执行 onBoxEnd 事件\n      this.dispatch('boxend', extent);\n    });\n  }\n\n  // 关闭 extends ToggleActive\n  deactivateHandle() {\n    // 切换光标样式\n    this._map.toggleCursorStyle();\n\n    // 移除图层与交互\n    this._olMap.removeInteraction(this._dragBox);\n    this._dragBox = null;\n\n    // 清理旧的框选（暂不清理）\n    // this.removeBoxFeature();\n  }\n\n  /**\n   * 展示框选本身的 feature\n   */\n  addBoxFeature(feature) {\n    this._feature = feature;\n    this._map.addFeature(this._feature);\n  }\n\n  /**\n   * 移除框选本身的 feature\n   */\n  removeBoxFeature() {\n    this._map.removeFeature(this._feature);\n    this._feature = null;\n  }\n}\n"],"names":["BoxSelection","map","_map","_olMap","olMap","_vectorSource","vectorSource","eventHub","on","removeBoxFeature","toggleCursorStyle","_dragBox","DragBox","minArea","addInteraction","toggleSelectInteraction","dispatch","geometry","getGeometry","extent","getExtent","addBoxFeature","OlFeature","removeInteraction","feature","_feature","addFeature","removeFeature","classMixin","GISEvent","ToggleActive"],"mappings":";;;;;;;;;;;;IAUqBA;;;;;wBAOPC,GAAZ,EAAiB;;;;;sFACT,iBAAN;;;;;;;;;;;;UAEKC,IAAL,GAAYD,GAAZ;UACKE,MAAL,GAAcF,GAAG,CAACG,KAAlB;UACKC,aAAL,GAAqBJ,GAAG,CAACK,YAAzB;IAEAL,GAAG,CAACM,QAAJ,CAAaC,EAAb,CAAgB,OAAhB,EAAyB;aAAM,MAAKC,gBAAL,EAAN;KAAzB;;;;;;qCAIe;;;UACTR,GAAG,GAAG,KAAKC,IAAjB;MAGAD,GAAG,CAACS,iBAAJ,CAAsB,WAAtB;WAGKC,QAAL,GAAgB,IAAIC,OAAJ,CAAY;QAC1BC,OAAO,EAAE;OADK,CAAhB;;WAGKV,MAAL,CAAYW,cAAZ,CAA2B,KAAKH,QAAhC;;WAGKA,QAAL,CAAcH,EAAd,CAAiB,UAAjB,EAA6B,YAAM;QACjCP,GAAG,CAACc,uBAAJ,CAA4B,KAA5B;;QAEA,MAAI,CAACC,QAAL,CAAc,UAAd;OAHF;;WAKKL,QAAL,CAAcH,EAAd,CAAiB,QAAjB,EAA2B,YAAM;QAC/BP,GAAG,CAACc,uBAAJ,CAA4B,IAA5B;;YAGME,QAAQ,GAAG,MAAI,CAACN,QAAL,CAAcO,WAAd,EAAjB;;YACMC,MAAM,GAAGF,QAAQ,CAACG,SAAT,EAAf;;QAGA,MAAI,CAACX,gBAAL;;QAGA,MAAI,CAACY,aAAL,CACE,IAAIC,SAAJ,CAAc;UACZL,QAAQ,EAARA;SADF,CADF;;QAOA,MAAI,CAACD,QAAL,CAAc,QAAd,EAAwBG,MAAxB;OAlBF;;;;uCAuBiB;WAEZjB,IAAL,CAAUQ,iBAAV;;WAGKP,MAAL,CAAYoB,iBAAZ,CAA8B,KAAKZ,QAAnC;;WACKA,QAAL,GAAgB,IAAhB;;;;kCASYa,SAAS;WAChBC,QAAL,GAAgBD,OAAhB;;WACKtB,IAAL,CAAUwB,UAAV,CAAqB,KAAKD,QAA1B;;;;uCAMiB;WACZvB,IAAL,CAAUyB,aAAV,CAAwB,KAAKF,QAA7B;;WACKA,QAAL,GAAgB,IAAhB;;;;;EApFsCG,UAAU,CAACC,QAAD,EAAWC,YAAX;;;;"}