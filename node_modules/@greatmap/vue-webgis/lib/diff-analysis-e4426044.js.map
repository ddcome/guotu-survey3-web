{"version":3,"file":"diff-analysis-e4426044.js","sources":["../src/gis/api/modules/diff-analysis.js","../src/gis/core/modules/diff-analysis.js"],"sourcesContent":["import { createOverlayAnalysis as baseCreateOverlayAnalysis } from '../analysis-service';\nimport { SERVER_CONFIG } from '../../config/server';\n\nconst arcgisOrigin = SERVER_CONFIG.arcgisOrigin;\nconst superDataPath = SERVER_CONFIG.superDataPath;\n\n/**\n * 创建叠加分析\n * @param {String} serviceUrl 服务 URL，创建服务返回\n * @param {String} serviceId 服务 ID，创建服务返回\n * @param {String} name overlay 服务名称\n * @param {String} inputServiceCode 输入图层服务名\n * @param {String} [inputFilter] 输入图层过滤值\n * @param {String} overlayServiceCode 叠加图层服务名\n * @param {String} [overlayFilter] 叠加图层过滤值\n * @param {String} [overlayType] 叠加类型\n * @returns {Promise}\n */\nexport function createOverlayAnalysis({\n  serviceUrl,\n  serviceId,\n  name,\n  inputServiceCode,\n  inputFilter,\n  overlayServiceCode,\n  overlayFilter,\n  overlayType = 'Erase'\n}) {\n  const inputLayer = {\n    url: `${arcgisOrigin}/server/rest/services/DataStoreCatalogs/${superDataPath}/BigDataCatalogServer/${inputServiceCode}`,\n    name: `${superDataPath}-${inputServiceCode}`\n  };\n  if (inputFilter) {\n    inputLayer.filter = inputFilter;\n  }\n\n  const overlayLayer = {\n    url: `${arcgisOrigin}/server/rest/services/DataStoreCatalogs/${superDataPath}/BigDataCatalogServer/${overlayServiceCode}`,\n    name: `${superDataPath}-${overlayServiceCode}`\n  };\n  if (overlayFilter) {\n    overlayLayer.filter = overlayFilter;\n  }\n\n  return baseCreateOverlayAnalysis({\n    serviceUrl,\n    serviceId,\n    name,\n    overlayType,\n    inputLayer,\n    overlayLayer\n  });\n}\n","import { createOverlayAnalysis } from '../../api/modules/diff-analysis';\nimport {\n  createAnalysisService,\n  getAnalysisResult\n} from '../../api/analysis-service';\nimport BaseAnalysis from '../common/base-analysis';\n\nexport default class DiffAnalysis extends BaseAnalysis {\n  constructor(map) {\n    super(map);\n  }\n\n  /**\n   * 执行分析\n   *\n   * @param {String} inputServiceCode 输入图层服务名\n   * @param {String} [inputFilter] 输入图层过滤值\n   * @param {String} overlayServiceCode 叠加图层服务名\n   * @param {String} [overlayFilter] 叠加图层过滤值\n   *\n   * @return {Promise}\n   */\n  doAnalysis({\n    inputServiceCode,\n    inputFilter,\n    overlayServiceCode,\n    overlayFilter\n  }) {\n    const serviceName = 'diffAnalysis_overlay_' + Date.now();\n\n    return createAnalysisService(serviceName).then((res) => {\n      return createOverlayAnalysis({\n        serviceUrl: res.serviceurl,\n        serviceId: res.itemId,\n        name: serviceName,\n        inputServiceCode,\n        inputFilter,\n        overlayServiceCode,\n        overlayFilter\n      }).then((res) => {\n        return this.getProgress('OverlayLayers', res.jobId).then(() => {\n          return getAnalysisResult(serviceName, this._wkid).then((res) => {\n            this._map.interactions.zoom.toFeatures(\n              this._map.renderFeatureData(res)\n            );\n            return res;\n          });\n        });\n      });\n    });\n  }\n}\n"],"names":["arcgisOrigin","SERVER_CONFIG","superDataPath","createOverlayAnalysis","serviceUrl","serviceId","name","inputServiceCode","inputFilter","overlayServiceCode","overlayFilter","overlayType","inputLayer","url","filter","overlayLayer","baseCreateOverlayAnalysis","DiffAnalysis","map","serviceName","Date","now","createAnalysisService","then","res","serviceurl","itemId","getProgress","jobId","getAnalysisResult","_wkid","_map","interactions","zoom","toFeatures","renderFeatureData","BaseAnalysis"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,IAAMA,YAAY,GAAGC,aAAa,CAACD,YAAnC;AACA,IAAME,aAAa,GAAGD,aAAa,CAACC,aAApC;AAcA,AAAO,SAASC,qBAAT,OASJ;MARDC,UAQC,QARDA,UAQC;MAPDC,SAOC,QAPDA,SAOC;MANDC,IAMC,QANDA,IAMC;MALDC,gBAKC,QALDA,gBAKC;MAJDC,WAIC,QAJDA,WAIC;MAHDC,kBAGC,QAHDA,kBAGC;MAFDC,aAEC,QAFDA,aAEC;8BADDC,WACC;MADDA,WACC,iCADa,OACb;MACKC,UAAU,GAAG;IACjBC,GAAG,YAAKb,YAAL,qDAA4DE,aAA5D,mCAAkGK,gBAAlG,CADc;IAEjBD,IAAI,YAAKJ,aAAL,cAAsBK,gBAAtB;GAFN;;MAIIC,WAAJ,EAAiB;IACfI,UAAU,CAACE,MAAX,GAAoBN,WAApB;;;MAGIO,YAAY,GAAG;IACnBF,GAAG,YAAKb,YAAL,qDAA4DE,aAA5D,mCAAkGO,kBAAlG,CADgB;IAEnBH,IAAI,YAAKJ,aAAL,cAAsBO,kBAAtB;GAFN;;MAIIC,aAAJ,EAAmB;IACjBK,YAAY,CAACD,MAAb,GAAsBJ,aAAtB;;;SAGKM,uBAAyB,CAAC;IAC/BZ,UAAU,EAAVA,UAD+B;IAE/BC,SAAS,EAATA,SAF+B;IAG/BC,IAAI,EAAJA,IAH+B;IAI/BK,WAAW,EAAXA,WAJ+B;IAK/BC,UAAU,EAAVA,UAL+B;IAM/BG,YAAY,EAAZA;GAN8B,CAAhC;;;ICrCmBE;;;;;wBACPC,GAAZ,EAAiB;;;qFACTA,GADS;;;;;qCAmBd;;;UAJDX,gBAIC,QAJDA,gBAIC;UAHDC,WAGC,QAHDA,WAGC;UAFDC,kBAEC,QAFDA,kBAEC;UADDC,aACC,QADDA,aACC;UACKS,WAAW,GAAG,0BAA0BC,IAAI,CAACC,GAAL,EAA9C;aAEOC,qBAAqB,CAACH,WAAD,CAArB,CAAmCI,IAAnC,CAAwC,UAACC,GAAD,EAAS;eAC/CrB,qBAAqB,CAAC;UAC3BC,UAAU,EAAEoB,GAAG,CAACC,UADW;UAE3BpB,SAAS,EAAEmB,GAAG,CAACE,MAFY;UAG3BpB,IAAI,EAAEa,WAHqB;UAI3BZ,gBAAgB,EAAhBA,gBAJ2B;UAK3BC,WAAW,EAAXA,WAL2B;UAM3BC,kBAAkB,EAAlBA,kBAN2B;UAO3BC,aAAa,EAAbA;SAP0B,CAArB,CAQJa,IARI,CAQC,UAACC,GAAD,EAAS;iBACR,KAAI,CAACG,WAAL,CAAiB,eAAjB,EAAkCH,GAAG,CAACI,KAAtC,EAA6CL,IAA7C,CAAkD,YAAM;mBACtDM,iBAAiB,CAACV,WAAD,EAAc,KAAI,CAACW,KAAnB,CAAjB,CAA2CP,IAA3C,CAAgD,UAACC,GAAD,EAAS;cAC9D,KAAI,CAACO,IAAL,CAAUC,YAAV,CAAuBC,IAAvB,CAA4BC,UAA5B,CACE,KAAI,CAACH,IAAL,CAAUI,iBAAV,CAA4BX,GAA5B,CADF;;qBAGOA,GAAP;aAJK,CAAP;WADK,CAAP;SATK,CAAP;OADK,CAAP;;;;;EAvBsCY;;;;"}