[TOC]

# 所有模块

| 模块名称            | 描述                         | 实例中对应的属性            |
| ------------------- | ---------------------------- | --------------------------- |
| `LayerSwipe`        | 卷帘功能（内置模块）         | `modules.layerSwipe`        |
| `Measure`           | 测量功能（内置模块）         | `modules.measure`           |
| `ImageLayer`        | 图片图层管理                 | `modules.imageLayer`        |
| `HistoryRecord`     | 历史记录管理（内置模块）     | `modules.historyRecord`     |
| `FeatureSelect`     | 要素拾取功能（内置模块）     | `modules.featureSelect`     |
| `BufferAnalysis`    | 缓冲区分析                   | `modules.bufferAnalysis`    |
| `DiffAnalysis`      | 对比分析                     | `modules.diffAnalysis`      |
| `IntersectAnalysis` | 相交分析                     | `modules.intersectAnalysis` |
| `BoxSelection`      | 框选交互（基类，不对外开放） | （无）                      |
| `Zoom`              | 缩放交互（内置交互）         | `interactions.zoom`         |
| `DragPan`           | 拖动交互（内置交互）         | `interactions.dragPan`      |
| `Draw`              | 绘制交互（内置交互）         | `interactions.draw`         |
| `DragZoom`          | 拖动缩放交互（内置交互）     | `interactions.dragZoom`     |

> 内置模块与内置交互表示默认已经加载该功能，无需外面引入，但是可以使用它。

## 模块的 API

### LayerSwipe 卷帘功能

- `toggleActive(state?, type)` 切换状态
  - `state` 激活状态（true/false)
  - `type` 测量类型 (line/area)
- `changeValue(value)` 修改卷帘值
  - `value` 卷帘百分比 0 - 100 （不带 %，number 类型）
- `changeType(type)` 修改卷帘类型，支持 `vertical/horizontal` 纵向/横向模式

### Measure 测量功能

- `toggleActive(state?, type)` 切换状态
  - `state` 激活状态（true/false)
  - `type` 测量类型 (LineString/Polygon)

### ImageLayer 图片图层管理

所有 API 挂载在 `modules.imageLayer` 下。

- `change(serviceCode, serverType, serverId): void` 更改图片图层
  - `serviceCode` 服务代码，例如：X510183TDXZG2017
  - `serverType` 服务类型，例如：MapServer/ImageServer
  - `serverId` 服务 ID，例如：0
- `remove(): void` 清理图片图层

### HistoryRecord 历史记录管理，默认模块

所有 API 挂载在 `modules.historyRecord` 下。

- `change(direction): void` 历史记录更改
  - `direction` = 1 向前（右）
  - `direction` = -1 向后（左）
- `clean(): void` 清理记录

### FeatureSelect 要素拾取功能，默认模块

所有 API 挂载在 `modules.featureSelect` 下。

- `on(eventName, callback)` 事件监听，提供 start/end 两个事件
  - `start` 开始分析回调，void 类型
  - `end` 分析结束回调，返回 { state: Boolean, data: Object|Array, message: String }
    - `state` 是否成功
    - `data` 成功的数据
    - `message` 失败的信息
  - `select` 在 feature 上点选事件，返回点选的数据
- `toggleActive(state?)` 切换状态（true/false），默认取与当前状态相反的值
- `toggleFeatureSelectListener(state?)` 切换监听选取要素事件状态（true/false），默认取与当前状态相反的值
- `updateFeatures(features)` 更新要素列表
  - `features` 要素对象集合
- `selectFeature(BSM)` 手动点选要素
  - `BSM` Number 要素的 ID

### BufferAnalysis 缓冲区分析

所有 API 挂载在 `modules.bufferAnalysis` 下。

- `on(eventName, callback)` 事件监听，提供 next 事件
  - `next` 分析进度 +1 回调，返回进度消息
- `doAnalysis(extent, distance = 0)` 开始分析
  - `extent` Array 范围
  - `distance` Number 缓冲距离

实例：

```vue
<template>
  <WebGIS
    @init="onInit($event)"
    :options="{ serviceCode: 'Counties' }"
    :modules="['BufferAnalysis']"
    showControls="true"
  />
</template>

<script>
import WebGIS from '@greatmap/vue-webgis';

export default {
  components: {
    WebGIS
  },
  methods: {
    onInit(webgis) {
      // 获取 webgis
      this.webgis = webgis;

      // 获取缓冲分析功能模块
      const bufferAnalysis = webgis.modules.bufferAnalysis;

      // 缓冲分析进度监听
      bufferAnalysis.on('next', (message) => console.log(message));

      // 开始分析
      bufferAnalysis.doAnalysis([1, 1, 1, 1], 10);
    }
  }
};
</script>
```

### DiffAnalysis 对比分析

所有 API 挂载在 `modules.diffAnalysis` 下。

- `on(eventName, callback)` 事件监听，提供 next 事件
  - `next` 分析进度 +1 回调，返回进度消息
- `doAnalysis(inputServiceCode, inputFilter, overlayServiceCode, overlayFilter)` 开始分析
  - `inputServiceCode` String 输入图层服务名，例如：X510183TDXZG2017XZQ
  - `inputFilter` String 输入图层过滤值，例如：DLTB = '0120'
  - `overlayServiceCode` String 叠加图层服务名，例如：X510183TDXZG2017XZQ
  - `overlayFilter` String 叠加图层过滤值，例如：DLTB = '0120'

### IntersectAnalysis 相交分析

所有 API 挂载在 `modules.intersectAnalysis` 下。

- `doAnalysis(layerID, geometry)` 执行分析，返回 `Promise<分析结果数组>`
  - `layerID` String 图层 ID，例如：X510183TDXZG2017XZQ
  - `geometry` Number[]|Geometry 范围，例如：`[1, 2, 3, 4]` 或者 `ol/geom/Polygon` 或者 `ol/geom/Point` 或者 `ol/geom/LineString`

### BoxSelection 框选交互（基类，不对外开放）

`BoxSelection` 为基础交互类，需要在这基础上实现其他功能。无单独的功能。

- `on(eventName, callback)` 事件监听，提供 boxstart/boxend 两个事件
  - `boxstart` 开始框选
  - `boxend` 框选结束，返回 extent 数据，String 类型
- `toggleActive(state?)` 切换状态（true/false），默认取与当前状态相反的值
- `addBoxFeature()` 展示框选本身的 feature
- `removeBoxFeature()` 移除框选本身的 feature

### Zoom 缩放交互（内置交互）

所有 API 挂载在 `interactions.zoom` 下。

- `change(type)` type 视图缩放类型
  - String zoom-in/zoom-out/revert
  - Number 直接更改 zoom 值
- `syncMapsMove(maps)` 同步多个地图的位置与缩放
  - `maps` Array<Map> 多个 Map 实例
- `toFeatures(features, padding)`
  - `features` 要素集合
  - `padding` 缩放时的 padding 值，默认 [0, 0, 0, 0]
- `resetView(padding)` 重置视图为当前展示的图层范围内
  - `padding` 同上

### DragPan 拖动交互（内置交互）

所有 API 挂载在 `interactions.dragPan` 下。

- `toggleActive(state?)` 切换状态（true/false），默认取与当前状态相反的值

### Draw 绘制交互（内置交互）

所有 API 挂载在 `interactions.draw` 下。

- `toggleActive(state?, type, isFreehand)` 切换状态
  - `state` 激活状态（true/false)
  - `type` 绘制类型类型 (LineString/Polygon/Circle/Point)
  - `isFreehand` 是否自由绘制
- `on(eventName, eventHandle)` 事件监听，提供 drawstart/drawend 两个事件
  - `drawstart` 开始绘制回调，返回 eventResult (见下方详情)
  - `drawend` 结束绘制回调，返回 eventResult (见下方详情)
- `clear()` 清理要素

eventResult 类型：

```js
/**
 * @typedef {{
 *   geometry: Geometry,
 *   extent: number[]
 * }} eventResult
 */
```

### DragZoom 拖动缩放交互（内置交互）

所有 API 挂载在 `interactions.dragZoom` 下。

- `toggleActive(state?, type)` 切换状态
  - `state` 激活状态（true/false)
  - `type` 绘制类型类型 (zoom-in/zoom-out)
