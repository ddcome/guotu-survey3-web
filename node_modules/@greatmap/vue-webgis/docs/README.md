[TOC]

# 简介

[TOC]

GreatMap webgis 封装，将 gis 逻辑独立，openlayers 与 gis 服务提供地图的展示，交互。

vue 的组件仅提供模版功能（地图覆盖层的 UI 交互）。他们之间通过 API 来进行交互。

应用的打包使用 [rollup](https://www.rollupjs.com) 框架实现，打包格式为 esm，所有外置模块都不在该包内。

- [查看组件 API 文档](../README.md)
- [查看完整的功能模块列表](modules.md)

# 目录介绍

```
|- build 进行生产的配置文件
|- docs 文档目录
|- examples 测试实例
|- lib 打包输出
  |- index.js 默认的包（不包含 element-ui）
  |- element-ui.js 所需 element-ui 的包

|- packages 其他的组件（不包含在 index 中）
|- src
  |- components 地图 vue 组件
    |- map 地图组件（地图的初始化起点）
    |- modals 地图 modals（动态的窗口）
    |- split-screen 分屏组件
    |- webgis 单屏组件
    |- index.vue 主组件

  |- gis 地图核心业务逻辑
    |- api gis 服务的接口
    |- config 地图相关配置信息
    |- core 地图核心功能
      |- common 基础功能类，用于继承
      |- controls 地图控件管理
      |- interactions 地图的交互功能
      |- modules 地图的相关模块功能
    |- styles 地图的样式
    |- utils 地图工具函数
    |- index.js 地图入口文件

  |- mixins 组件之间共用的混入对象
    |- controls-clean.js 执行清理（this.clean 方法）
    |- controls-feature-select.js 要素拾取的切换（this.featureSelectToggle 方法）
    |- private-event-hub.js 私有的事件中心（this.$eventHub 对象）
    |- split-screen-toggle.js 分屏切换（this.splitScreenToggle 方法）
    |- webgis-init.js 当前组件内的 webgis 在组件间的注册与注入（this.initWebgis 方法初始化，this.$webgis 访问实例）
    |- webgis-init-common.js 用于当前对间内与对外的 webgis 初始化公共部分
    |— webgis-props.js 组件接受外部的 props 对象

  |- plugins 地图组件所需的插件
    |- element.js element-ui 组件注册
    |- svg-icon.js svg 图标组件注册

  |- styles 组件的样式
    |- common-variables.scss 公共的 scss 样式变量（便于应用的样式统一风格）
    |- public.scss 全局的样式类

  |- utils 工具函数
  |- common.js 公共的入口文件
  |- index.js 应用打包入口文件
  |- element-ui.js 单独的 element-ui 包入口文件
|- stat 包体积分析结果存放目录
|- babel.config.js babel 配置文件
```

# API 说明

## 核心部分

核心逻辑较复杂，这里只提供大的执行流程，细节请仔细参阅代码与注释。

```
src/gis/core
|- gis-config.js 获取配置，生成地图初始化的选项
|- gis-utils.js 提供地图的工具函数
|- layer-management.js 图层的管理
|- layer-tree.js 图层树的操作
|- map.js 执行初始化配置，初始化地图
```

## WebGIS 组件 API

[查看组件 API 文档](../README.md)。

# 模块说明

每个应用可能模块功能不一致，这里提供模块配置来进行不同功能的不同模块进行按需加载。

> 注意：模块的注册与应用需要特定的命名。

## 模块使用

1. 配置所需模块（非必填），在实例化 `Map` 时，传入第二个参数 `modules[]`，模块名称使用大写驼峰。
2. 初始化完成后，通过实例上的 `[moduleName]` 访问模块的功能。

```
// 声明所需模块 ['ExampleModule']
const map = new Map(target, ['ExampleModule']);

// 读取模块的方法
map.exampleModule.doSomeThing()
```

## 支持的模块

[查看完整的功能模块列表](modules.md)。

## 模块的开发

### 创建模块

在 ./src/gis/modules/ 下创建 example-module.js:

- **仅导出一个默认模块**
- **构造器仅传入地图实例作为参数**

```
// 导出默认模块
export default class ExampleModule {
  // 构造器只有一个参数：Map 实例
  constructor(map) {
    // ...doSomeThing()
  }
}
```

### 注册模块

在 ./src/gis/modules/index.js 中注册模块：

> 注意：这里是以函数的方式进行异步加载的。

```
export const modules = {
  BufferAnalysis: () => import('./buffer-analysis')
};
```

# 注意事项

1. **./src/gis/ 下为地图核心业务逻辑，./src/components/ 下为地图组件逻辑，开发时务必将逻辑分开。**
2. **提供外部接口请挂载在 `Map` 类上，外部交互一致通过生成的实例进行。**
3. **类的方法必须区分公开还是私有（\_下划线)，私有方法外部禁止调用。**
4. **提交更改时，请勿忘记打包。**
5. **组件样式如果不使用 scoped，请使用类似 BEM 样式规范来避免样式污染。**
6. **在 ./build/index.js 中可配置多入口打包。**

# 开始

- `npm start` 开启开发服务器
- `npm run build` 打包代码
- `npm run lint` 格式化代码
- `npm run build-analyzer` 打包分析
- `vue-cli-service build` 打包 examples
