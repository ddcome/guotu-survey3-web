// 简易 store 模式，用于数据在组件中的共享
import { warnMessage } from '../utils/error-handler';

export const store = {
  state: {
    // state 下的数据需保持对象形式，否则更改后失去响应式作用
    shareData: {}
  },
  /**
   * 更新 state 数据
   * @param {String} stateName
   * @param {Object} data
   */
  commit(stateName, data) {
    if (this.state.hasOwnProperty(stateName)) {
      mergeState(this.state[stateName], data);
      if (process.env.NODE_ENV === 'development') {
        console.info(`state.state.${stateName} is change.`, data);
      }
    } else {
      warnMessage(`store.state.${stateName} is not found.`);
    }
  }
};

function mergeState(source, data) {
  let item;
  for (let key in source) {
    if (source.hasOwnProperty(key)) {
      item = data[key];
      if (item) {
        source[key] = item;
      }
    }
  }
}
