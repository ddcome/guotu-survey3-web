<template>
  <div class="webgis-aside-tools webgis-absolute-layer">
    <el-button @click="historyRecordChange(-1)">
      <SvgIcon name="long-arrow-alt-left" />
    </el-button>
    <el-button @click="historyRecordChange(1)">
      <SvgIcon name="long-arrow-alt-right" />
    </el-button>
    <div class="spacer"></div>
    <el-button
      :class="{ active: dragZoomActive === 'zoom-in' }"
      @click="toggleDragZoom('zoom-in')"
    >
      <SvgIcon name="search-plus" />
    </el-button>
    <el-button
      :class="{ active: dragZoomActive === 'zoom-out' }"
      @click="toggleDragZoom('zoom-out')"
    >
      <SvgIcon name="search-minus" />
    </el-button>
    <el-button @click="zoomRevert()">
      <SvgIcon name="globe-americas" />
    </el-button>
    <div class="spacer"></div>
    <el-button @click="toggleDragPan()">
      <SvgIcon :name="dragPanActive ? 'arrows-alt' : 'lock'" />
    </el-button>
    <el-button @click="toggleAside()">
      <SvgIcon name="layer-group" />
    </el-button>
  </div>
</template>

<script>
import SvgIcon from '../../../plugins/svg-icon';
import { webgisInject } from '../../../mixins/webgis-init';
import { privateEventHubInject } from '../../../mixins/private-event-hub';

export default {
  name: 'WebGISAsideTools',
  mixins: [webgisInject, privateEventHubInject],
  components: {
    SvgIcon
  },
  data() {
    return {
      dragPanActive: true,
      dragZoomActive: '' // ''|'zoom-in'|'zoom-out'
    };
  },
  methods: {
    toggleDragPan(state = !this.dragPanActive) {
      this.dragPanActive = state;
      this.$webgis.interactions.dragPan.toggleActive(state);
    },
    toggleAside() {
      this.$eventHub.$emit('toggleAside');
    },
    zoomRevert() {
      this.$webgis.interactions.zoom.change('revert');
    },
    // type = zoom-in/zoom-out
    toggleDragZoom(type) {
      this.dragZoomActive =
        this.dragZoomActive && this.dragZoomActive === type ? '' : type;
      this.$webgis.interactions.dragZoom.toggleActive(
        !!this.dragZoomActive,
        type
      );
    },
    closeDragZoom() {
      this.toggleDragZoom();
    },
    // direction = 1/-1
    historyRecordChange(direction) {
      this.$webgis.modules.historyRecord.change(direction);
    },
    afterInitWebgis() {
      // dragZoom 在绘制完毕后关闭
      const dragZoom = this.$webgis.interactions.dragZoom;
      dragZoom.on('boxend', this.closeDragZoom);
    }
  },
  beforeDestroy() {
    this.$webgis.interactions.dragZoom.offAll('boxend', this.closeDragZoom);
  }
};
</script>

<style lang="scss" scoped>
@import '../../../styles/common-variables';

.webgis-aside-tools {
  display: flex;
  flex-direction: column;
  top: 60px;
  left: 10px;
  .el-button {
    transition: $transition-base;
    font-size: 20px;
    margin: 5px 0 0 !important; /* fix element-ui style */
    padding: 0;
    width: 35px;
    height: 35px;
    border: none;
    color: gray;
    box-shadow: $box-shadow-base;
    &:focus {
      border: 1px solid $--color-primary-light-7;
    }
    &.active,
    &:active {
      border: 1px solid $--button-primary-border-color;
      color: $color-primary;
    }
  }
  .spacer {
    height: 15px;
  }
}
</style>
